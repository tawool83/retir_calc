<!DOCTYPE html>
<html class="light" lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>은퇴 시뮬레이터</title>

<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<script>
tailwind.config = {
  darkMode: "class",
  theme: {
    extend: {
      colors: {
        primary: "#2563eb",
        secondary: "#1e40af"
      }
    }
  }
}
</script>

<style>
body { font-family: 'Manrope', sans-serif; }
.table-scroll-area { max-height: 700px; overflow-y: auto; }
</style>
</head>

<body class="bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 min-h-screen">

<main class="max-w-7xl mx-auto p-8">

<h1 class="text-3xl font-extrabold mb-6">
은퇴 <span class="text-primary">시뮬레이터</span>
</h1>

<div class="grid lg:grid-cols-2 gap-8">

<!-- ================= 설정 영역 ================= -->
<div class="space-y-6">

<div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow">
<h2 class="font-bold mb-4">기본 설정</h2>

<label class="block mb-3">
현재 나이
<input id="ageNow" type="number" class="w-full mt-1 border rounded px-3 py-2"/>
</label>

<label class="block mb-3">
은퇴 나이
<input id="ageRetire" type="number" class="w-full mt-1 border rounded px-3 py-2"/>
</label>

<label class="block mb-3">
초기 투자금 (원)
<input id="initialInvestment" type="text" class="w-full mt-1 border rounded px-3 py-2"/>
</label>

<label class="block mb-3">
월 투자금 (원)
<input id="monthlyContribution" type="text" class="w-full mt-1 border rounded px-3 py-2"/>
</label>

<label class="flex items-center gap-2">
<input type="checkbox" id="autoZeroAfterRetire"/>
은퇴 이후 납입금 0 자동 전환
</label>

</div>

<div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow">
<h2 class="font-bold mb-4">전략 프리셋</h2>

<select id="presetSelect" class="w-full border rounded px-3 py-2 mb-3"></select>

<div class="flex justify-between text-sm">
<div>연 수익률: <span id="presetReturn"></span></div>
<div>배당률: <span id="presetDiv"></span></div>
</div>

</div>

</div>

<!-- ================= 결과 영역 ================= -->
<div>

<div class="bg-white dark:bg-slate-800 rounded-xl shadow overflow-hidden">

<div class="p-4 border-b flex justify-between items-center">
<h2 class="font-bold">연도별 시뮬레이션 결과</h2>
<button onclick="exportCSV()" class="text-sm bg-slate-200 px-3 py-1 rounded">
CSV 내보내기
</button>
</div>

<div class="table-scroll-area overflow-x-auto">
<table class="w-full text-sm text-left">
<thead class="bg-slate-100 dark:bg-slate-700 text-xs uppercase">
<tr>
<th class="p-3">연도 / 나이</th>
<th class="p-3">연간 납입금</th>
<th class="p-3">수익</th>
<th class="p-3">배당</th>
<th class="p-3">연금 인출</th>
<th class="p-3">기말 자산</th>
</tr>
</thead>
<tbody id="annualTbody"></tbody>
</table>
</div>

</div>

<div class="mt-6 bg-primary/10 p-4 rounded">
<p id="observation" class="text-sm"></p>
</div>

</div>

</div>
</main>

<script>
// ================= 원화 포맷 =================
function formatKRW(value){
return "₩" + Math.round(value).toLocaleString("ko-KR");
}

// ================= 기본 프리셋 =================
const presets = [
{id:"sp500", name:"S&P500", annualReturn:10, dividend:1.5},
{id:"nasdaq", name:"나스닥100", annualReturn:14.2, dividend:0.8},
{id:"schd", name:"SCHD", annualReturn:8.5, dividend:3.4}
];

let selectedPreset = presets[0];

function initPresets(){
const select = document.getElementById("presetSelect");
presets.forEach(p=>{
const opt = document.createElement("option");
opt.value = p.id;
opt.textContent = p.name;
select.appendChild(opt);
});
select.addEventListener("change",()=>{
selectedPreset = presets.find(p=>p.id===select.value);
updatePresetUI();
calculate();
});
updatePresetUI();
}

function updatePresetUI(){
document.getElementById("presetReturn").textContent = selectedPreset.annualReturn + "%";
document.getElementById("presetDiv").textContent = selectedPreset.dividend + "%";
}

// ================= 계산 =================
function calculate(){

const ageNow = Number(document.getElementById("ageNow").value);
const retireAge = Number(document.getElementById("ageRetire").value);
const initial = Number(document.getElementById("initialInvestment").value.replace(/,/g,""));
let monthly = Number(document.getElementById("monthlyContribution").value.replace(/,/g,""));
const autoZero = document.getElementById("autoZeroAfterRetire").checked;

let balance = initial;
const tbody = document.getElementById("annualTbody");
tbody.innerHTML = "";

for(let age=ageNow; age<=100; age++){

if(autoZero && age>=retireAge) monthly=0;

let annualContribution = monthly*12;
let annualReturn = balance*(selectedPreset.annualReturn/100);
let dividend = balance*(selectedPreset.dividend/100);

balance += annualContribution + annualReturn + dividend;

const row = document.createElement("tr");
row.innerHTML = `
<td class="p-3">${new Date().getFullYear()+(age-ageNow)} / ${age}세</td>
<td class="p-3">${formatKRW(annualContribution)}</td>
<td class="p-3">${formatKRW(annualReturn)}</td>
<td class="p-3">${formatKRW(dividend)}</td>
<td class="p-3">₩0</td>
<td class="p-3 font-bold">${formatKRW(balance)}</td>
`;
tbody.appendChild(row);
}

document.getElementById("observation").textContent =
`${retireAge}세 은퇴 시 예상 자산은 ${formatKRW(balance)} 입니다.`;
}

// ================= CSV =================
function exportCSV(){
let csv="연도,나이,연간납입금,수익,배당,기말자산\n";
document.querySelectorAll("#annualTbody tr").forEach(row=>{
let cols=[...row.children].map(td=>td.innerText);
csv+=cols.join(",")+"\n";
});
const blob=new Blob([csv],{type:"text/csv"});
const url=URL.createObjectURL(blob);
const a=document.createElement("a");
a.href=url;
a.download="은퇴시뮬레이션.csv";
a.click();
}

// ================= 이벤트 =================
document.querySelectorAll("input").forEach(i=>{
i.addEventListener("input",calculate);
});

initPresets();
calculate();
</script>

</body>
</html>
